<th:block th:fragment="modal-search-content(endpointGetExcept, idOwnExcept)" xmlns:th="http://www.thymeleaf.org">
    <div class="modal fade" id="modal-search-song">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Search song</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="card card-default">
                        <div class="card-body">
                            <form th:action="${type == 'audiobook' ? '/music/audiobook/index' : (type == 'podcast' ? '/music/podcast/index' : '/music/song/index')}" method="get">
                                <div class="row">
                                    <div class="col-3" th:insert="component :: input-text(#{name}, 'name', null, 0, 255, false, false)"></div>
                                    <div class="col-3 mb-3" th:with="options=${T(java.util.Arrays).asList(
                            '', 'All',
                            '0', 'Free',
                            '1', 'Coin',
                            '2', 'Money'
                        )}">
                                        <div th:replace="component :: select-default-v2(#{typeEarn}, 'typeEarn', null, false, false, ${options})"></div>
                                    </div>
                                    <div class="col-3 mb-3" th:with="options=${T(java.util.Arrays).asList(
                            '', 'All',
                            '1', 'Active',
                            '0', 'Inactive',
                            '-1', 'Deleted'
                        )}">
                                        <div th:replace="component :: select-default-v2(#{status}, 'status', null, false, false, ${options})"></div>
                                    </div>
                                    <div class="col-3 mb-3" th:insert="component :: select2-multiple('GET', #{categories}, 'categories', null, ${'/search/music/category/ajax-search?type=' + (type == 'audiobook' ? 1 : 0)}, #{enterCategories}, false, false, 0, null)"></div>
                                    <div class="col-3 mb-3" th:insert="component :: select2-v2('GET', #{title.index.publisher}, 'publisher', null, '/search/music/publisher/ajax-search', #{enterPublisher}, ${publisherName} , false, false, 0, null)"></div>
                                    <div class="col-3 mb-3" th:if="${type=='audiobook'}" th:insert="component :: select2-v2('GET', #{title.index.reader}, 'reader', null, '/search/music/reader/ajax-search', #{enterReader}, ${readerName} , false, false, 0, null)"></div>
                                    <div class="col-3 mb-3" th:if="${type=='audiobook'}" th:insert="component :: input-date-ranger-v3(#{publishedTime}, 'publisherDate', null, false, false, 'DD/MM/YYYY', 3, 0, false)"></div>

                                    <div class="col-3 d-flex" style="align-items: start; margin-top:5px; padding-top: 24px;">
                                        <button onclick="searchSong();" type="button" class="btn btn-primary my-0 mx-1">
                                            <i class="fas fa-search"></i><span class="px-2">Search</span>
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div class="card card-default">
                        <div class="card-body" id="placeRenderSongs">

                        </div>
                    </div>
                </div>
                <div class="modal-footer justify-content-end">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(() => {
            searchSong(1);
        })

        function searchSong(initPageNo, isNotifySuccess) {
            toastLoading();
            let pageNo = initPageNo ? initPageNo : $('#buuPaginationSong').pagination('getCurrentPage');
            let pageSize = $('#buuPageSizeSong').val();
            let name = $('#name').val();
            let typeEarn = $('#typeEarn').val();
            let status = $('#status').val();
            let categories = $('#categories').val();
            let publisher = $('#publisher').val();
            let reader = $('#reader').val();
            let publisherDate = $('#publisherDate').val();

            $.ajax({
                url: '[[${endpointGetExcept}]]',
                type: 'GET',
                data: {
                    id: '[[${idOwnExcept}]]'
                },
                success: function(data) {
                    console.log(data);

                    $.ajax({
                        url: '[[@{/music/{type}/render-search(type = ${type})}]]',
                        type: 'GET',
                        data: {
                            pageNo,
                            pageSize,
                            name,
                            typeEarn,
                            status,
                            categories,
                            publisher,
                            reader,
                            publisherDate,
                            exceptIds: data
                        },
                        traditional: true,
                        success: function(data) {
                            $('#placeRenderSongs').html(data);
                            if (isNotifySuccess) {
                                toastSuccess("Success!");
                            } else {
                                Swal.close();
                            }
                        },
                        error: function(xhr, status, error) {
                            toastError("An error has occurred!", 3000);
                        }
                    });
                },
                error: function(xhr, status, error) {
                    toastError("An error has occurred", 3000);
                }
            });
        }
    </script>
</th:block>











<th:block th:fragment="content-search-song" xmlns:th="http://www.thymeleaf.org">
    <div class="table-responsive mb-2 mt-3">
        <table class="table table-sm custom-table table-bordered table-hover text-center" style="table-layout: auto; width: 100%; font-weight: 600;">
            <thead class="thead-light align-content-center">
            <tr>
                <th  style="width: 0%"></th>
                <th th:text="#{id}"></th>
                <th th:text="#{name}"></th>
                <th th:text="#{image}" style="width: 0%"></th>
                <th th:text="#{status}" ></th>
                <th th:text="#{typeEarn}" style="width: 10%"></th>
                <th th:text="#{publishedTime}" th:if="${type=='audiobook'}"></th>
                <th th:text="#{createdAt}"></th>
                <th th:text="#{totalListens}" style="width: 10%"></th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="model,item : ${models}" th:attr="data-id=${model.id}">
                <td style="align-content: center;">
                    <button th:attr="onclick=|addSong(event, ${model.id})|" type="button" class="btn btn-success my-0">
                        <i class="fas fa-plus"></i><span class="px-2">Add</span>
                    </button>
                </td>
                <td th:text="${model.id}" style="align-content: center;"></td>
                <td th:text="${model.name}" style="align-content: center;"></td>
                <td>
                    <div class="dropdown">
                        <img class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" th:onerror="this.onerror=null; this.src=[[${@environment.getProperty('domain.nginx')}]] + '/img/no-image-square.jpg';"
                             style="height: 60px;width:60px" th:src="${@environment.getProperty('domain.nginx')} + ${model.image}">
                        <div class="dropdown-menu p-1" aria-labelledby="dropdownMenu2">
                            <img style="height: 200px;width:200px" th:src="${@environment.getProperty('domain.nginx')} + ${model.image}" th:onerror="this.onerror=null; this.src=[[${@environment.getProperty('domain.nginx')}]] + '/img/no-image-square.jpg';">
                        </div>
                    </div>
                </td>
                <td style="align-content: center;">
                    <span th:if="${model.status == 0}" class="badge badge-danger" style="white-space: normal; cursor: pointer;">Inactive</span>
                    <span th:if="${model.status == 1}" class="badge badge-success" style="white-space: normal; cursor: pointer">Active</span>
                    <span th:if="${model.status == -1}" class="badge badge-danger" style="white-space: normal; cursor: pointer;">Deleted</span>
                </td>
                <td style="align-content: center;">
                    <span th:if="${model.typeEarn == 0}" class="badge badge-light" style="white-space: normal; cursor: pointer;">Free</span>
                    <span th:if="${model.typeEarn == 1}" class="badge badge-warning" style="white-space: normal; cursor: pointer">Coin</span>
                    <span th:if="${model.typeEarn == 2}" class="badge badge-success" style="white-space: normal; cursor: pointer;">Money</span>
                </td>
                <td th:text="${#dates.format(new java.util.Date(model.publisherDate), 'dd/MM/yyyy')}" style="align-content: center;" th:if="${type=='audiobook'}"></td>
                <td th:text="${#dates.format(new java.util.Date(model.createdAt), 'dd/MM/yyyy HH:mm:ss')}" style="align-content: center;"></td>
                <td th:text="${model.totalListen}" style="align-content: center;"></td>
            </tr>
            <tr th:if="${models.size()==0}">
                <td colspan="100">No result</td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="d-flex justify-content-between">
        <div class="d-flex font-weight-bold align-items-center">
            <p class="m-0">Hiển thị </p>
            <select id="buuPageSizeSong" class="buu_page_size mx-2 font-weight-bold">
                <option value="10" selected th:selected="${pageSize == 10}">10</option>
                <option value="20" th:selected="${pageSize == 20}">20</option>
                <option value="30" th:selected="${pageSize == 30}">30</option>
                <option value="40" th:selected="${pageSize == 40}">40</option>
                <option value="50" th:selected="${pageSize == 50}">50</option>
            </select>
            <input type="hidden" name="pageSize" value="10" />
            <p class="m-0">Phần tử</p>
        </div>
        <ul id="buuPaginationSong" class="pagination buu-pagination"></ul>
    </div>
    <script th:inline="javascript">
        $(() => {
            let selectPageSize = document.querySelector('#buuPageSizeSong');
            let inputPageSize = document.querySelector('#buuPageSizeSong + input[name="pageSize"]');
            if(inputPageSize) inputPageSize.value = [[${pageSize}]];

            function formatPageNumberSong() {
                $('#buuPaginationSong').find('a, span').each(function() {
                    let pageNumber = parseInt($(this).text());

                    if (!isNaN(pageNumber)) {
                        $(this).text(pageNumber.toLocaleString().replaceAll('.', ','));
                    }
                });
            }

            selectPageSize.addEventListener("change", function (e) {
                if(inputPageSize) inputPageSize.value = this.value;
                $('#buuPaginationSong').pagination('selectPage', 1);
            })

            $('#buuPaginationSong').pagination({
                items: [[${totalPage}]],
                itemOnPage: [[${pageSize}]],
                currentPage: [[${pageNo}]],
                cssStyle: '',
                prevText: '<',
                nextText: '>',
                onInit: function () {
                    // lúc load trang hàm này sẽ được gọi
                    formatPageNumberSong();
                },
                onPageClick: function (page, e) {
                    formatPageNumberSong();

                    // Lúc chuyển trang hàm này sẽ được gọi
                    searchSong();
                }
            });
        })
    </script>
</th:block>