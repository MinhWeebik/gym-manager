<hungtvt xmlns:th="http://www.thymeleaf.org">
    <!-- Todo: -Bootstrap5@Css -Sweetalert2@Js  -->
    <th:block th:fragment="form-delete">
        <form id="buu_form_delete" method="POST" action="" class="d-none">
            <input type="hidden" name="id" value="">
        </form>
        <script th:inline="javascript">
            function deleteRecord({method, action}) {
                const formDelete = document.querySelector("#buu_form_delete");
                Swal.fire({
                    title: [[#{sweet-alert.delete.title}]],
                    text: [[#{sweet-alert.delete.text}]],
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: [[#{sweet-alert.delete.btn-confirm}]],
                    cancelButtonText: [[#{sweet-alert.btn-cancel}]]
                }).then((result) => {
                    if (result.isConfirmed) {
                        formDelete.action = action;
                        formDelete.method = method;
                        formDelete.submit();
                    }
                });
            }
        </script>
    </th:block>

    <!-- Todo: -Bootstrap5@Css -SimplePagination@Js -Jquery@Js -BuuPagination@Css  -->
    <th:block th:fragment="pagination(pageNo, totalPage, pageSize, buuPageSize, buuPagination)">
        <div class="d-flex justify-content-between">
            <div class="d-flex font-weight-bold align-items-center">
                <p class="m-0" >Đang hiển thị</p>
                <select th:id="buuPageSize" class="buu_page_size mx-2 font-weight-bold">
                    <option value="15" selected th:selected="${pageSize == 15}">15</option>
                    <option value="30" th:selected="${pageSize == 30}">30</option>
                    <option value="45" th:selected="${pageSize == 45}">45</option>
                    <option value="60" th:selected="${pageSize == 60}">60</option>
                    <option value="75" th:selected="${pageSize == 75}">75</option>
                </select>
                <input type="hidden" name="pageSize" value="10" />
                <p class="m-0">bản ghi</p>
            </div>
            <ul th:id="buuPagination" class="pagination buu-pagination"></ul>
        </div>
        <script th:inline="javascript">
            let selectPageSize = document.querySelector('#' + [[${buuPageSize}]]);
            let inputPageSize = document.querySelector('#' + [[${buuPageSize}]] + ' + input[name="pageSize"]');
            if(inputPageSize) inputPageSize.value = [[${pageSize}]];

            function formatPageNumber() {
                $('#' + [[${buuPagination}]]).find('a, span').each(function() {
                    let pageNumber = parseInt($(this).text());

                    if (!isNaN(pageNumber)) {
                        $(this).text(pageNumber.toLocaleString().replaceAll('.', ','));
                    }
                });
            }

            selectPageSize.addEventListener("change", function (e) {
                if(inputPageSize) inputPageSize.value = this.value;
                $('#' + [[${buuPagination}]]).pagination('selectPage', 1);
            })

            $('#' + [[${buuPagination}]]).pagination({
                items: [[${totalPage}]],
                itemOnPage: [[${pageSize}]],
                currentPage: [[${pageNo}]],
                cssStyle: '',
                prevText: '<',
                nextText: '>',
                onInit: function () {
                    // lúc load trang hàm này sẽ được gọi
                    formatPageNumber();
                },
                onPageClick: function (page, e) {
                    formatPageNumber();

                    // Lúc chuyển trang hàm này sẽ được gọi
                    let parsedUrl = new URL(window.location.href);
                    let params = parsedUrl.searchParams;

                    params.set("pageNo", page);
                    params.set("pageSize", selectPageSize.value);

                    parsedUrl.search = params.toString();
                    console.log(parsedUrl.toString());
                    window.location.href = parsedUrl.toString();
                }
            });
        </script>
    </th:block>

    <div th:fragment="select2-v2-search-for(method, label, name, value, url, title, text, required, disabled, minimumInputLength, idNeedSearch, additionalParams)">
        <label th:for="${name}"><span>[[${label}]] <span th:if="${required}" style="color: red;">*</span></span></label>
        <select th:id="${name}" th:name="${name}" class="form-control" th:required="${required}" th:disabled="${disabled}" style="width: 100%">
            <option th:value="${value}" th:text="${text}"></option>
        </select>
        <script th:inline="javascript">
            $('#' + [[${name}]]).select2({
                ajax: {
                    type: [[${method}]],
                    url: [[${@environment.getProperty('server.servlet.context-path') + url}]],
                    dataType: 'json',
                    delay: 250,
                    data: function(params) {
                        let query = {
                            input: params.term
                        }

                        let idNeedSearch = [[${idNeedSearch}]];
                        idNeedSearch.forEach((item) => {
                            console.log(item, document.querySelector(`#${item}`).value);
                            query[item] = document.querySelector(`#${item}`).value;
                        });
                        console.log(query);
                        let additionalParams = [[${additionalParams}]];
                        console.log(additionalParams);
                        if(additionalParams != null) {
                            additionalParams.forEach(param => {
                                query[param.value] = param.text;
                            });
                        }
                        return query;
                    },
                    processResults: function(data) {
                        return {
                            results: data
                        };
                    },
                    cache: true
                },
                placeholder: [[${title}]],
                minimumInputLength: [[${minimumInputLength}]],
                allowClear: true
            });
        </script>
    </div>

    <!-- Hỗ trợ custom tham số gửi lên -->
    <div th:fragment="select2-v2-search-for-V2(method, label, name, value, url, title, text, required, disabled, minimumInputLength, idNeedSearch, paramNeedSearch, additionalParams)">
        <label th:for="${name}"><span>[[${label}]] <span th:if="${required}" style="color: red;">*</span></span></label>
        <select th:id="${name}" th:name="${name}" class="form-control" th:required="${required}" th:disabled="${disabled}" style="width: 100%">
            <option th:value="${value}" th:text="${text}"></option>
        </select>
        <script th:inline="javascript">
            $('#' + [[${name}]]).select2({
                ajax: {
                    type: [[${method}]],
                    url: [[${@environment.getProperty('server.servlet.context-path') + url}]],
                    dataType: 'json',
                    delay: 250,
                    data: function(params) {
                        let query = {
                            input: params.term
                        }

                        let idNeedSearch = [[${idNeedSearch}]];
                        let paramNeedSearch = [[${paramNeedSearch}]]
                        idNeedSearch.forEach((item, index) => {
                            query[paramNeedSearch[index]] = document.querySelector(`#${item}`).value;
                        });

                        let additionalParams = [[${additionalParams}]];
                        if(additionalParams != null) {
                            additionalParams.forEach(param => {
                                query[param.value] = param.text;
                            });
                        }
                        return query;
                    },
                    processResults: function(data) {
                        return {
                            results: data
                        };
                    },
                    cache: true
                },
                placeholder: [[${title}]],
                minimumInputLength: [[${minimumInputLength}]],
                allowClear: true
            });
        </script>
    </div>

    <div th:fragment="select2-v2-search-for-V3(method, label, name, value, url, title, text, required, disabled, readonly, minimumInputLength, idNeedSearch, paramNeedSearch, additionalParams)">
        <label th:for="${name}"><span>[[${label}]] <span th:if="${required}" style="color: red;">*</span></span></label>
        <select th:id="${name}" th:name="${name}" class="form-control" th:required="${required}" th:disabled="${disabled}" th:readonly="${readonly}" style="width: 100%">
            <option th:value="${value}" th:text="${text}"></option>
        </select>
        <script th:inline="javascript">
            $('#' + [[${name}]]).select2({
                ajax: {
                    type: [[${method}]],
                    url: [[${@environment.getProperty('server.servlet.context-path') + url}]],
                    dataType: 'json',
                    delay: 250,
                    data: function(params) {
                        let query = {
                            input: params.term
                        }

                        let idNeedSearch = [[${idNeedSearch}]];
                        let paramNeedSearch = [[${paramNeedSearch}]]
                        idNeedSearch.forEach((item, index) => {
                            query[paramNeedSearch[index]] = document.querySelector(`#${item}`).value;
                        });

                        let additionalParams = [[${additionalParams}]];
                        if(additionalParams != null) {
                            additionalParams.forEach(param => {
                                query[param.value] = param.text;
                            });
                        }
                        return query;
                    },
                    processResults: function(data) {
                        return {
                            results: data
                        };
                    },
                    cache: true
                },
                placeholder: [[${title}]],
                minimumInputLength: [[${minimumInputLength}]],
                allowClear: true
            });
        </script>
    </div>

    <!-- Todo: -Bootstrap5@Css -Jquery@Js -BuuStepProcessBar@Css  -->
    <th:block th:fragment="step-process-bar(labels, links, active)">
        <div class="row mb-5">
            <div class="col-10 m-auto">
                <div class="buu-spb-wrapper">
                    <th:block th:each="label : ${labels}">
                        <div th:class="${labelStat.index == 0 ? 'buu-spb-start ' : ''} + 'buu-spb-node' + ${labelStat.index + 1 < active ? ' active' : ''}"
                             th:style="${labelStat.index + 1 == active - 1 ? 'animation: nodeLight 1s cubic-bezier(.4, 0, .2, 1);' : labelStat.index + 1 == active ? 'animation: waitNode 0.5s linear;' : ''}"
                        >
                            <span>[[${labelStat.index + 1}]]</span>
                            <i class="fa-solid fa-check" th:style="${labelStat.index + 1 == active - 1 ? 'animation: textChange 0.5s cubic-bezier(.4, 0, .2, 1);' : ''}"></i>
                            <a th:href="${links.get(labelStat.index)}"></a>
                            <label>[[${label}]]</label>
                        </div>
                        <div th:if="${labelStat.index + 1 < labels.size()}" class="buu-spb-line">
                            <span th:style="${labelStat.index + 1 == active - 1 ? 'animation: lineRun 0.5s linear 0s;' : ''}"></span>
                        </div>
                    </th:block>
                </div>
            </div>
        </div>
        <script th:inline="javascript">
            $('.buu-spb-node label').each(function() {
                if($(this).width() >= 130) {
                    $(this).addClass("buu-limit-width");
                }
            });
        </script>
    </th:block>

    <th:block th:fragment="modal-detail">
        <div class="modal fade" id="modal-detail">
            <div class="modal-dialog modal-sm-2">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Detail</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <table class="table custom-table table-bordered table-sm table-striped">
                            <tbody id="body-detail">

                            </tbody>
                        </table>
                    </div>
                    <div class="modal-footer justify-content-end">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </th:block>
</hungtvt>